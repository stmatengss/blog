<!doctype html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/blog/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/blog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/blog/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/blog/favicon.ico?v=5.1.1" />






<meta name="description" content="...">
<meta property="og:type" content="website">
<meta property="og:title" content="Teng&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/blog/index.html">
<meta property="og:site_name" content="Teng&#39;s Blog">
<meta property="og:description" content="...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Teng&#39;s Blog">
<meta name="twitter:description" content="...">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blog/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/blog/"/>





  <title>Teng's Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-116728507-1', 'auto');
  ga('send', 'pageview');
</script>











</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/blog/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Teng's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">A coder and systemer</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/blog/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/blog/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/blog/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2018/11/04/Concepts-of-SkipList-Implementation-Concurrency-and-Lock-free/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/11/04/Concepts-of-SkipList-Implementation-Concurrency-and-Lock-free/" itemprop="url">Concepts of SkipList: Implementation, Concurrency and Lock-free</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-04T15:58:12+08:00">
                2018-11-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Concept"><a href="#Concept" class="headerlink" title="Concept"></a>Concept</h2><ul>
<li>Ordered Data Structure</li>
<li>Combining Multi-layer linked list together, the node number of every layer will exponential decline with a factor <code>K</code> and <code>K = 1 / r</code> which r is a critical threshold for skiplist.</li>
<li>Each node has <code>N</code> pointer to its next nodes, the N is known as the degree of this node.</li>
<li>Support: O(log n) CRUD (Create/Read/Update/Delete)</li>
<li><p>Find Operation</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Find (K):</div><div class="line">  ptr = head-&gt;next_list[max_level - 1]</div><div class="line">  for i in max_level to 0:</div><div class="line">    find the last node (last_node) whose key is large than K</div><div class="line">    ptr = pre_node-&gt;next_list[i]</div><div class="line">    // updates[i] = pre_node</div><div class="line">  if ptr-&gt;key == K</div><div class="line">    return ptr</div><div class="line">  return nullptr // return updata array if you need a insert</div></pre></td></tr></table></figure>
<ul>
<li>Insert Operation<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Insert (K, V):</div><div class="line">  ptr, updates = Find(K)</div><div class="line">  if ptr == nullptr:</div><div class="line">    new_node = NewSkipListNode()</div><div class="line">    new_degree = skiplist_rand()</div><div class="line">    for i in 0 to max_level:</div><div class="line">      new_node-&gt;next_node[i] = updates-&gt;next_list[i]</div><div class="line">      updates-&gt;next_list[i] = new_node</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p><img src="https://i.imgur.com/nNjOtfa.png" alt="Skiplist"></p>
<h2 id="Vary-Implementations"><a href="#Vary-Implementations" class="headerlink" title="Vary Implementations"></a>Vary Implementations</h2><ul>
<li>My Implementation is <a href="https://github.com/stmatengss/SkipList" target="_blank" rel="external">here</a></li>
<li>Google <code>nbds</code> is <a href="https://code.google.com/archive/p/nbds/" target="_blank" rel="external">here</a></li>
</ul>
<h2 id="Research-Areas"><a href="#Research-Areas" class="headerlink" title="Research Areas"></a>Research Areas</h2><ul>
<li>NVM based data structure<ul>
<li>How to design skiplist with less write overhead</li>
<li>How to persist skiplist in NVM</li>
<li>How to recover skiplist in NVM</li>
</ul>
</li>
<li>Distributed SkipList<ul>
<li>Partition/Across-Layers?</li>
<li>How to gain a higher concurrency</li>
</ul>
</li>
<li>Write Optimization<ul>
<li>Write-Optimize Skip List <a href="https://dl.acm.org/citation.cfm?id=3056117" target="_blank" rel="external">PODS’ 17</a><ul>
<li>Cache higher level of the data structures (closest to root)</li>
<li>TO DO ….</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Issues-when-concurrent-accessing"><a href="#Issues-when-concurrent-accessing" class="headerlink" title="Issues when concurrent accessing"></a>Issues when concurrent accessing</h2><ul>
<li>Write-Write Conflict</li>
<li>Dirty Read</li>
<li>Fine-grained lock for every node</li>
<li>COW (copy on write) will cause O (n) copying overhead</li>
</ul>
<h2 id="Lock-Free"><a href="#Lock-Free" class="headerlink" title="Lock-Free"></a>Lock-Free</h2><ul>
<li><a href="http://www.cse.yorku.ca/~ruppert/papers/lfll.pdf" target="_blank" rel="external">Lock-Free Linked List and Skip Lists [PODC’ 04]</a></li>
<li><a href="https://www.cl.cam.ac.uk/techreports/UCAM-CL-TR-579.pdf" target="_blank" rel="external">Practical lock-freedom</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2018/10/14/Distrubted-Concurrency-Control/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/10/14/Distrubted-Concurrency-Control/" itemprop="url">Distributed Concurrency Control</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-14T12:25:31+08:00">
                2018-10-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Read-Phenomena"><a href="#Read-Phenomena" class="headerlink" title="Read Phenomena"></a>Read Phenomena</h1><ul>
<li>Dirty Read</li>
<li>Non-repeatable Read</li>
<li>Phantom Read</li>
</ul>
<h1 id="Isolation-Level"><a href="#Isolation-Level" class="headerlink" title="Isolation Level"></a>Isolation Level</h1><ul>
<li>Serializable</li>
<li>Repeatable Read</li>
<li>Read Committed</li>
<li>Read Uncommitted</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2018/10/05/CMU-15-645-Distributed-OLTP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/10/05/CMU-15-645-Distributed-OLTP/" itemprop="url">CMU 15-645 Distributed OLTP</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-05T21:43:48+08:00">
                2018-10-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="OLTP-v-s-OLAP"><a href="#OLTP-v-s-OLAP" class="headerlink" title="OLTP v.s. OLAP"></a>OLTP v.s. OLAP</h1><ul>
<li>On-line Transaction Processing<ul>
<li>Short-lived TX</li>
<li>Small footprint</li>
<li>Repetitive operation</li>
</ul>
</li>
<li>On-line Analytical processing<ul>
<li>Long running queries</li>
<li>Complex joins</li>
<li>Exploratory queries</li>
</ul>
</li>
</ul>
<h1 id="Architectures"><a href="#Architectures" class="headerlink" title="Architectures:"></a>Architectures:</h1><ul>
<li>Shared Everything -&gt; Shared Memory -&gt; Shared Disk -&gt; Shared Nothing<ul>
<li>Shared Nothing (Only via network): Easy to increase capacity and hard ensure consistency at the same time</li>
</ul>
</li>
</ul>
<h1 id="Data-Transparency"><a href="#Data-Transparency" class="headerlink" title="Data Transparency"></a>Data Transparency</h1><ul>
<li>Partitioned (Sharding) v.s. Replicated</li>
<li>Horizontal Partitioning (Round-robin/Hash/Range)</li>
</ul>
<h1 id="Distributed-Transactions"><a href="#Distributed-Transactions" class="headerlink" title="Distributed Transactions"></a>Distributed Transactions</h1><ul>
<li>Centralized v.s. Decentralized</li>
</ul>
<h1 id="Distributed-CC"><a href="#Distributed-CC" class="headerlink" title="Distributed CC"></a>Distributed CC</h1><ul>
<li>Need to allow multi-TXs to execute simultaneously across multi-nodes<ul>
<li>Factors: Replication, Network Communication Overhead, Node Failure, Clock skew</li>
<li><code>Atomic Commit Protocol</code></li>
</ul>
<ul>
<li>2PC, 3PC, Paxos, Raft, ZAB</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2018/10/05/CMU-15-645-Recovery/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/10/05/CMU-15-645-Recovery/" itemprop="url">CMU 15-645 Recovery</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-05T21:13:48+08:00">
                2018-10-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>When discussing recovery, we have to mention <code>ARIES</code> system (full name: Algorithms for Recovery and Isolation Exploiting Semantics)</li>
</ul>
<h1 id="LSN-Log-Sequence-Number"><a href="#LSN-Log-Sequence-Number" class="headerlink" title="LSN (Log Sequence Number)"></a>LSN (Log Sequence Number)</h1><ul>
<li>Types<br>| Name  | Where  | Definition  |<br>|—|—|—|<br>| flushdLSN  | RAM  | Last LSN in log on disk  |<br>| pageLSN  | @page  | Newest update to page  |<br>| recLSN  | @page  | Oldest update to page  |<br>| lastLSN  | Tj  | Last action of TX Tj |<br>| MasterRecord  | Disk  | LSN of latest checkpoint  | </li>
<li></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2018/10/05/CMU-15-645-Logging-Schemes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/10/05/CMU-15-645-Logging-Schemes/" itemprop="url">CMU 15-645 Logging Schemes</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-05T14:37:27+08:00">
                2018-10-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Recovery-Algorithm"><a href="#Recovery-Algorithm" class="headerlink" title="Recovery Algorithm"></a>Recovery Algorithm</h1><ul>
<li>Today: ensure DBMS can recover from a failure (during normal TX processing)</li>
<li>Idea: Recover to a state with ACID guarantee</li>
</ul>
<h1 id="Classifications"><a href="#Classifications" class="headerlink" title="Classifications"></a>Classifications</h1><ul>
<li>Storage Types: Volatile Storage (DRAM/SRAM) =&gt; Non-volatile Storage (HDD, SSD, NVM) =&gt; Stable Storage (multiple storage devices)</li>
<li>Failure Types: Transaction / System / Storage Media<ul>
<li>Transaction Errors: Logical errors / Internal State Errors</li>
<li>System Errors: Software (Exceptions, e.g., divide by zero) / hardware (Power down)</li>
</ul>
<ul>
<li>Fail-Stop Assumption: Non-volatile Storage will not be corrupted</li>
</ul>
<ul>
<li>Storage Media Failure: Game Over! WTF</li>
</ul>
</li>
</ul>
<h1 id="Use-volatile-memory-for-faster-access"><a href="#Use-volatile-memory-for-faster-access" class="headerlink" title="Use volatile memory for faster access:"></a>Use volatile memory for faster access:</h1><ul>
<li>Procedures (Buffer Pool):<ol>
<li>Copy target record into memory</li>
<li>Perform the writes in memory</li>
<li>Write Dirty records back to disks</li>
</ol>
</li>
<li>Issue: There are two transactions: T1, T2. T1 is still uncommitted but T2 is already committed. At the same time, the dirty records is written back to non-volatile device. T1 needs to roll back. What’s happened?<ul>
<li>Steal + Force:<ol>
<li>Never have to undo changes of an aborted TX because the changes were not written to disk</li>
<li>Never have to redo changes of a committed TX because all the changes are guaranteed to be written to disk at commit time</li>
</ol>
</li>
</ul>
</li>
</ul>
<h1 id="Shadow-Paging"><a href="#Shadow-Paging" class="headerlink" title="Shadow Paging"></a>Shadow Paging</h1><ul>
<li>Automatically switch roles between master and shadow</li>
<li>Undo: Remove the shadow pages, switch to the master</li>
<li>Cons:<ol>
<li>Copying the entire page table is expensive (a index structure like B+Tree, Path copying)</li>
<li>Commit Overhead is high</li>
</ol>
</li>
</ul>
<h1 id="WAL-Write-Ahead-Log"><a href="#WAL-Write-Ahead-Log" class="headerlink" title="WAL (Write Ahead Log)"></a>WAL (Write Ahead Log)</h1><ul>
<li>Format <code>&lt;Tid, Object Id, Previous Value, Current Value&gt;</code> (Undo + Redo)</li>
<li>Trade-off: <ol>
<li>When should we write log entries to disk?</li>
<li>When should we write dirty records to disk?</li>
</ol>
</li>
</ul>
<h1 id="Log-Styles"><a href="#Log-Styles" class="headerlink" title="Log Styles"></a>Log Styles</h1><ul>
<li>Physical Log: Record the data changes in the database</li>
<li>Logical Log: Higher level operations (e.g., UPDATE, INSERT)<ul>
<li>Cons: higher time costing to recover</li>
<li>Pros: Less space needed</li>
</ul>
</li>
</ul>
<h1 id="Checkpoint"><a href="#Checkpoint" class="headerlink" title="Checkpoint"></a>Checkpoint</h1><ul>
<li>Actions:<ol>
<li>Output onto stable storage all log records currently residing in main memory</li>
<li>Output to the disk all modified blocks</li>
<li>Write a <code>&lt;CHECKPOINT&gt;</code> entry to the log and flush to stable storage</li>
</ol>
</li>
<li>Recovery: Redo committed TXs after checkpoint + Undo uncommitted TXs after checkpoint</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2018/10/04/CMU-15-645-Concurrency-Control-TimeStamp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/10/04/CMU-15-645-Concurrency-Control-TimeStamp/" itemprop="url">CMU 15-645 Concurrency Control TimeStamp</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-04T22:09:28+08:00">
                2018-10-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Principle"><a href="#Principle" class="headerlink" title="Principle"></a>Principle</h1><ul>
<li>If <code>TS(Ti)</code> &lt; <code>TS(Tj)</code>, then it must be <code>Ti</code> appears before <code>Tj</code></li>
</ul>
<h1 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation:"></a>Implementation:</h1><ul>
<li>System Clock/Logical Counter/Hybrid</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2018/10/04/CMU-15-645-Concurrency-Control-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/10/04/CMU-15-645-Concurrency-Control-summary/" itemprop="url">CMU 15-645 Concurrency Control summary</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-04T20:08:10+08:00">
                2018-10-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Before-reading-this-article-you-should-know"><a href="#Before-reading-this-article-you-should-know" class="headerlink" title="Before reading this article, you should know:"></a>Before reading this article, you should know:</h1><ul>
<li>Transaction: a sequence of read and write operations<ul>
<li>processing: BEGIN -&gt; (executing) -&gt; COMMIT/ABORT</li>
<li>ACID</li>
</ul>
<ul>
<li>Atomicity: All-or-nothing</li>
<li>Consistent: It looks correct to me </li>
<li>Isolation: every TX is isolated from others (as if alone)</li>
<li>Durability: store in non-volatile devices (survive failures)</li>
</ul>
</li>
</ul>
<h1 id="How-to-make-sure-transaction-is-atomic"><a href="#How-to-make-sure-transaction-is-atomic" class="headerlink" title="How to make sure transaction is atomic"></a>How to make sure transaction is atomic</h1><ul>
<li>Approach 1: Logging</li>
<li>Approach 2: Shadow Paging</li>
</ul>
<h1 id="The-essential-of-concurrency-control"><a href="#The-essential-of-concurrency-control" class="headerlink" title="The essential of concurrency control"></a>The essential of concurrency control</h1><ul>
<li>Serial Schedule</li>
</ul>
<h1 id="The-definition-of-conflict"><a href="#The-definition-of-conflict" class="headerlink" title="The definition of conflict"></a>The definition of conflict</h1><ul>
<li>They are by different transactions</li>
<li>They are on the same object and at least one of them is a write</li>
<li>RW/WR/WW conflict:<ul>
<li>Unrepeatable reads</li>
<li>Reading uncommitted data (a.k.a., Dirty Reads)</li>
<li>Overwriting committed data</li>
</ul>
</li>
</ul>
<h1 id="Dependency-Graphs-Precedence-Graph"><a href="#Dependency-Graphs-Precedence-Graph" class="headerlink" title="Dependency Graphs (Precedence Graph)"></a>Dependency Graphs (Precedence Graph)</h1><ul>
<li>conflict: acyclic</li>
<li>blind write: write a value without read it</li>
</ul>
<h1 id="2PL"><a href="#2PL" class="headerlink" title="2PL"></a>2PL</h1><ul>
<li>Phase 1: Growing =&gt; get all required locks from manager [grants/denies]</li>
<li>Phase 2: Shrinking =&gt; release all locks it gained</li>
<li>Strict 2PL: release all locks at the end of TX</li>
</ul>
<h1 id="2PL-Deadlock-Prevention"><a href="#2PL-Deadlock-Prevention" class="headerlink" title="2PL Deadlock Prevention"></a>2PL Deadlock Prevention</h1><ul>
<li>Wait-Die (old waits for young)</li>
<li>Wound-Wait (young waits for old)</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2018/09/20/Peer-to-Peer-Evolution/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/09/20/Peer-to-Peer-Evolution/" itemprop="url">Peer-to-Peer Evolution</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-20T15:38:21+08:00">
                2018-09-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="GPUDirect"><a href="#GPUDirect" class="headerlink" title="GPUDirect"></a>GPUDirect</h2><ul>
<li>Eliminate the need to make a redundant copy in CUDA host memory</li>
<li>Eliminate CPU bandwidth and latency bottlenecks</li>
</ul>
<h2 id="PeerDirect"><a href="#PeerDirect" class="headerlink" title="PeerDirect"></a>PeerDirect</h2><ul>
<li>Eliminate the need to make a redundant copy in host memory</li>
<li>Direct path for data exchange</li>
</ul>
<h2 id="PeerDirect-Async"><a href="#PeerDirect-Async" class="headerlink" title="PeerDirect Async"></a>PeerDirect Async</h2><ul>
<li>Control RDMA device from the GPU</li>
<li>Reduce CPU utilization</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2018/09/19/Transaction-Protocols/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/09/19/Transaction-Protocols/" itemprop="url">Transaction Protocols</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-19T00:11:36+08:00">
                2018-09-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Catalog"><a href="#Catalog" class="headerlink" title="Catalog"></a>Catalog</h2><ul>
<li>Concurrency Control<ul>
<li>Two-phase Locking (2PL)</li>
</ul>
<ul>
<li>NO_WAIT</li>
<li>WAIT_DIE</li>
</ul>
<ul>
<li>Timestamp Ordering (TIMESTAMP)</li>
<li>Multi-version concurrency control (MVCC)</li>
<li>Optimistic concurrency control (OCC)</li>
<li>Deterministic (CALVIN)</li>
</ul>
</li>
<li>Commitment Protocols<ul>
<li>Two-phase Commit (2PC)</li>
</ul>
</li>
</ul>
<h2 id="Classify-from-two-views"><a href="#Classify-from-two-views" class="headerlink" title="Classify from two views"></a>Classify from two views</h2><ul>
<li>Pessimistic v.s. Optimistic</li>
<li>Locked-based v.s. Timestamp-based</li>
</ul>
<h2 id="Comparison-from-another-view"><a href="#Comparison-from-another-view" class="headerlink" title="Comparison from another view"></a>Comparison from another view</h2><ul>
<li>Pessimistic<ul>
<li>Validate -&gt; Read -&gt; Compute -&gt; Write</li>
</ul>
</li>
<li>Optimistic<ul>
<li>Read -&gt; Compute -&gt; Validate -&gt; Write</li>
</ul>
</li>
</ul>
<h2 id="2-PL"><a href="#2-PL" class="headerlink" title="2-PL"></a>2-PL</h2><ul>
<li>Basic procedures:<ul>
<li>Expanding (Growing) Phase: lock are acquired</li>
<li>Shrinking (Contracting) Phase: lock are released</li>
</ul>
</li>
<li>Centralized 2PL: only one scheduler</li>
<li>Distributed 2PL: at each site, scheduler handle lock requests at that site</li>
</ul>
<h2 id="Timestamp-Ordering-based-algorithm"><a href="#Timestamp-Ordering-based-algorithm" class="headerlink" title="Timestamp Ordering based algorithm"></a>Timestamp Ordering based algorithm</h2><ul>
<li>In a distributed environment, TS requires globally unique and monotonically increasing</li>
<li>A global counter is not easy to maintain and local clock are unsuitable. So, a unique site identifier is needed (e.g., {local time, site indentifier})</li>
<li>Based TO:<ul>
<li>rts(x): largest TO of any read on x, wts(x): largest TO of any write on x<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">for Ri(x):</div><div class="line">  if ts(Ti) &lt; wts(x):</div><div class="line">  then reject Ri(x)</div><div class="line">  else accept Ri(x)</div><div class="line">   rts(x) &lt;- ts(Ti)</div><div class="line">for Wi(x):</div><div class="line">  if ts(Ti) &lt; rts(x) and ts(Ti) &lt; wts(x):</div><div class="line">  then reject Wi(x)</div><div class="line">  else accept Wi(x)</div><div class="line">   wts(x) &lt;- ts(Ti)</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="Pitfall"><a href="#Pitfall" class="headerlink" title="Pitfall"></a>Pitfall</h2><ul>
<li>Lock vs. Latch<ul>
<li>Locking mechanism can protect transaction ACID</li>
<li>Latching mechanism can protect data structure safe</li>
</ul>
</li>
<li>TO (Timestamp ordering) algorithm always will cause a deadlock situation (several transactions wait for each other)<ul>
<li>However, a intervention from outside is needed</li>
<li>Wait-for Graph (has a cycle =&gt; deadlock)</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2018/08/17/Survey-of-Distributed-Resource-Management/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/08/17/Survey-of-Distributed-Resource-Management/" itemprop="url">Survey of Distributed Resource Management</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-17T00:37:14+08:00">
                2018-08-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Foreword"><a href="#Foreword" class="headerlink" title="Foreword"></a>Foreword</h1><p>Recently, a new hot trending of rack-scale architecture named disaggregation was proposed to improve the data center. In industry, Intel <code>RSD</code> and and HP <code>the machine</code> will soon be available as real world DC resolutions. Some researches like Lego, infiniswap aim to find out the correct deployment guidelines and how to optimize disaggregation architecture. Disaggregation architecture divide machines into working one and resource one (blade server). This deployment make full use of decoupling and hence gain a higher resource utilization and release the working machine from heavy tasks of resource management.<br>However, similar as a standalone architecture, disaggregation architecture also has a need of resource management. Moreover, in a distributed environment, keeping allocation status consistency and persistence will be harder, as well as bringing a huge overhead in network.<br>The simplest design is using RPC to finish a allocation/release request of resource and naturally, also leading to a poor performance due to the frequently network communication.</p>
<h1 id="Related-works"><a href="#Related-works" class="headerlink" title="Related works"></a>Related works</h1><!-- Lego (OSDI' 18) provides a two-level resource management mechanism. In Lego, it adopts a tw -->
<p>Infiniswap (NSDI’ 17) exposes block device IO interface to VMM (virtual memory management). It divides entire address space to many slabs. Every slab is fixed size. Slabs from the same device can be mapped to multiple remote machines’ memory for performance and load balance.<br>The INFINISWAP daemon runs in the user space and only participates in control plane activities. Specifically, it responds to slab-mapping requests from INFINISWAP block devices, preallocates its local memory when possible to minimize time overheads in slab-mapping initialization, and proactively evicts slabs, when necessary, to ensure minimal impact on local applications. All control plane communications take place using RDMA SEND/RECV.<br>Lego (OSDI’ 18) seems to adopt a two-level resource management mechanism. The disaggregation back-end provides coarse grained management and front-end server is responsible for fine grained allocation.</p>
<h1 id="Trade-off"><a href="#Trade-off" class="headerlink" title="Trade-off"></a>Trade-off</h1><p>In a common sense, above two methods only fit infrequent allocation scenario, especially the resource is block device. When the disaggregation resource is byte-addressable memory or non-volatile memory, the frequent allocation/release is unavoidable and hence let allocation become a performance bottleneck.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/5/">5</a><a class="extend next" rel="next" href="/blog/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/blog/images/avatar.gif"
               alt="Teng Ma" />
          <p class="site-author-name" itemprop="name">Teng Ma</p>
           
              <p class="site-description motion-element" itemprop="description">...</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/blog/archives/">
                <span class="site-state-item-count">43</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/blog/tags/index.html">
                <span class="site-state-item-count">29</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/stmatengss" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://stackoverflow.com/users/5955640/stmatengss" target="_blank" title="Stackoverflow">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Stackoverflow
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/ma-teng-69a0a8115/" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Linkedin
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Teng Ma</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/blog/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/blog/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/blog/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/blog/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/blog/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/blog/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/blog/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/blog/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/blog/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/blog/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
