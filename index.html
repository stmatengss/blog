<!doctype html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/blog/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/blog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/blog/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/blog/favicon.ico?v=5.1.1" />






<meta name="description" content="...">
<meta property="og:type" content="website">
<meta property="og:title" content="Teng&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/blog/index.html">
<meta property="og:site_name" content="Teng&#39;s Blog">
<meta property="og:description" content="...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Teng&#39;s Blog">
<meta name="twitter:description" content="...">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blog/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/blog/"/>





  <title>Teng's Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-116728507-1', 'auto');
  ga('send', 'pageview');
</script>











</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/blog/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Teng's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">A coder and systemer</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/blog/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/blog/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/blog/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2018/06/01/Algorithms-Behind-Modern-Storage-Systems-Reproduced/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/06/01/Algorithms-Behind-Modern-Storage-Systems-Reproduced/" itemprop="url">Algorithms Behind Modern Storage Systems [Reproduced]</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-01T01:26:15+08:00">
                2018-06-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>The original article is <a href="https://queue.acm.org/detail.cfm?id=3220266" target="_blank" rel="external">here</a></p>
<h1 id="A-brief-introduction"><a href="#A-brief-introduction" class="headerlink" title="A brief introduction:"></a>A brief introduction:</h1><p>As we know, there are two kinds of workloads in database: one is write-heavy and the other is read-heavy.<br>With read-heavy workload, using B+Tree/B-Tree will bring with read optimization.<br>But it will be expensive when doing modification operation (update, insert or deletion) due to we need to merge/split nodes or move items in nodes.<br>B-Tree is 1) Sorted, 2) Self-balancing, 3) Logarithmic lookup time and 4) Mutable.<br>With write-heavy workload, LSM-Trees (log-structured merge-tree) is an immutable disk-resident write-optimized data structure.<br>It will transform most of the modification operations to a log entry and put it to SSTable (Sorted String Tables).<br>The upper layer of LSM-Tree is an in-memory skip-list or binary search tree to accelerate read operations.<br>When its size reaches to the threshold, this data structure will be flushed to disk with compaction.<br>LSM-Tree will be good for point-query and scan operation, but will not be friendly to find operation.</p>
<p>In order to batch these operation together for writing to disk with one IO operation,<br>we need to use WAL (write ahead log) to guarantee atomicity and durability.</p>
<p>In conclusion, there is no convenient to achieve higher performance for both write and read operations,<br>so we need to choose our data structure carefully.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2018/04/20/Survey-of-NVM-Allocator/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/04/20/Survey-of-NVM-Allocator/" itemprop="url">Survey of NVM Allocator</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-20T01:21:36+08:00">
                2018-04-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Goals"><a href="#Goals" class="headerlink" title="Goals"></a>Goals</h3><ul>
<li><p>A good allocator should:</p>
<ul>
<li>Memory Usage (fragmentation/overhead)</li>
<li>Performance (Tput)</li>
<li>Scalability (linearly)</li>
<li>Correctness</li>
<li>Robustness</li>
</ul>
</li>
<li><p>A good NVM allocator should:</p>
<ul>
<li>Recovery (time overhead)</li>
<li>Programablility (easy-to-use)</li>
<li>TODO….</li>
</ul>
</li>
</ul>
<h3 id="Recovery"><a href="#Recovery" class="headerlink" title="Recovery"></a>Recovery</h3><ul>
<li>Essentially, bitmap is a general method to maintain the peristent status of allocator. With bitmap, every bit can indicate this block is in-used or not</li>
</ul>
<h3 id="Defragmentation"><a href="#Defragmentation" class="headerlink" title="Defragmentation"></a>Defragmentation</h3><h3 id="Start-of-art"><a href="#Start-of-art" class="headerlink" title="Start-of-art"></a>Start-of-art</h3><ul>
<li><p>nvm_malloc (VLDB’ 16)</p>
<ul>
<li>Small-size =&gt; segregated-fit, larger-size =&gt; best-fit</li>
<li>Three-size allocation strategy</li>
</ul>
</li>
<li><p>Makalu (OOPLSA’ 16)</p>
<ul>
<li>Keeping volatiled pointer is still valid by using a fixed pool address (<code>MAP_FIXED</code> flag of <code>mmap</code>)</li>
</ul>
</li>
<li><p>NVML (<code>intel Pmem</code>)</p>
<ul>
<li>Support concurrent =&gt; Local thread cache</li>
<li>Minimize fragmentation =&gt; A chunk (256KB) is divided into blocks of 8X the class size.</li>
</ul>
</li>
<li><p>PAllocator</p>
<ul>
<li>Small/Larger/Huge Allocator</li>
</ul>
</li>
</ul>
<p><img src="/images/nvm_allocator.png" alt="Comparsion"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2018/04/10/Gprof-Valgrind-Gperf-etc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/04/10/Gprof-Valgrind-Gperf-etc/" itemprop="url">Gprof, Valgrind, Gperf, etc</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-10T17:15:14+08:00">
                2018-04-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>There are several analysis tools to measure our program and give suggestions to improve performance.<br>Now, we will introduce two common-used tools: gprof and valgrind</p>
<ul>
<li>Gprof<br>Gprof is a profiling program which collects and arranges statistics on your programs. It will insert codes to head and tail of each functions to collect running information by sampling some time points. When program running is end, it will create a file named <code>gmon.out</code>. And we can run profile tool to analysis occupied time of different functions.</li>
</ul>
<ol>
<li>Add <code>-pg</code> to your compiling file (e.g. CMake or Makefile)</li>
<li>Running your program <code>exe</code></li>
<li>Typing <code>gprof exe</code> in the command<br>There is another easy-to-use tool <code>gprof2dot</code> to visualize your analytics results. You can use <code>gprof exe | gprof2dot | dot -Tpdf -o result.pdf</code> to generate a pdf file to display the results. <code>gprof2dot</code> is a python tool, and you can use <code>pip</code> to install it.</li>
</ol>
<ul>
<li>Valgrind<br>Valgrind was originally designed to be a free memory debugging tool for Linux on x86, but has since evolved to become a generic framework for creating dynamic analysis tools such as checkers and profilers. Callgrind is a competent of valgrind for profiling CPU usage. With Callgrind, you can look up the running time of different functions. Similarly, another tool Kcachegrind is useful to provide a visual interface for beginner. Fortunately, you don’t need to add extra compiling flags, and you just need following three steps:</li>
</ul>
<ol>
<li>Compile your project as usual</li>
<li>Running callgrind with <code>valgrind --tool=callgrind ./cpuload</code></li>
<li>kcachegrind profile.callgrind</li>
</ol>
<p>Using these out-of-box tools will benefit to hint us to optimize our codes well. Besides, other performance library like <code>libpapi</code> need us to insert codes to our program, and it’s not good for programmability. For me, I prefer to use these performance profile tools to detect my codes.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2018/04/10/What-s-a-good-paper/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/04/10/What-s-a-good-paper/" itemprop="url">What's a good paper?</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-10T15:36:47+08:00">
                2018-04-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>A good paper will:</p>
<ul>
<li>Motivate a significant problem</li>
<li>Propose an interesting, compelling solution</li>
<li>Demonstrate the practicality and benefits of the solution</li>
<li>Draw appropriate conclusions</li>
<li>Clearly describe the paper’s contributions</li>
<li>Clearly articulate the advances beyond previous work</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2018/03/04/Academic-Writing-Tips/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/03/04/Academic-Writing-Tips/" itemprop="url">Academic Writing Tips</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-04T23:45:55+08:00">
                2018-03-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>Paper Roadmap<ul>
<li>Problem -&gt; Ideas -&gt; Methods -&gt; Algorithm -&gt; Implementation -&gt; Experiments -&gt; Conclusion</li>
</ul>
</li>
<li>Logic<ul>
<li>Transfer words (link sentences)</li>
<li>Connection between points and points</li>
<li>Claim the whole section in the head</li>
</ul>
</li>
<li>Writing Paradigm<ul>
<li>Problem X is important (in theory or application)</li>
<li>Work A, B, C… are state of the art method for X</li>
<li>A, B, C… have weakness not solved</li>
<li>Analyze the weakness and propose a new method D</li>
<li>Experimentally compare D with A, B, C</li>
<li>Why does D work? Why E, F, G do not work?</li>
<li>Strngth and weakness of D</li>
<li>Future work of D</li>
</ul>
</li>
<li><p>Rejection. Why?</p>
<ol>
<li>Not enough <code>Innovation</code><ul>
<li>Has done before</li>
<li>Too straightforward/naive (Simple is good, but straightforward is bad)</li>
<li>Limited modifications/improvement</li>
<li>Intuitive technique, without serious theory proof</li>
</ul>
</li>
<li><code>Experiments</code> cannot convice readers or need more experiments<ul>
<li>Lack of comparsion (with state-of-art methods)</li>
<li>Unfair comparsion</li>
<li>Unbelievable Results</li>
<li>The advancement is limited</li>
</ul>
</li>
<li>Don’t claim a clear <code>Motivation</code><ul>
<li>Which problem will be solved? And <code>why</code>?<ul>
<li>ignored problems</li>
<li>exsiting problems with not excellent solution</li>
</ul>
</li>
</ul>
</li>
<li><code>Discussion</code> or <code>Conclusion</code> is not rigorous<ul>
<li>The discussion about previous works is not appropriate<ul>
<li>One-sided</li>
<li>Inaccurate about advantages/disadvantages</li>
<li>Casual logic is unreasonable</li>
</ul>
</li>
</ul>
</li>
<li>Others:<ul>
<li>Architecture Chaos and lack of logic</li>
<li>Lower level mistakes</li>
<li>It’s hard for reader to understand / Don’t provide enough background</li>
<li>Lack of Citations</li>
<li>Have confictions with reviewers</li>
</ul>
</li>
</ol>
</li>
<li><p>Fluent writing</p>
<ul>
<li>From lower level to higher level (You know your work well, but the readers not)</li>
<li>From old to new information<ul>
<li>Never introduce new concept at the beginning of a sentence</li>
<li>Must explain the abbreviation before using it</li>
</ul>
</li>
<li>Section/Paragraph<ul>
<li>Abstract the contents before you want to introduce a new topic</li>
</ul>
</li>
</ul>
</li>
<li><p>Abundant Figure and Table</p>
<ul>
<li>Figure<ul>
<li>Self explaination</li>
<li>Easy to understand</li>
</ul>
</li>
<li>Table<ul>
<li>Sorted!</li>
<li>The important one must put into the header or tail</li>
</ul>
</li>
</ul>
</li>
<li><p>Tips</p>
<ol>
<li>One paper, single central message/contribution</li>
<li>Story must be Top-down</li>
<li>Outlines -&gt; Section -&gt; Subsection -&gt; Paragraph</li>
<li>First =&gt; Introduction + Related Works</li>
<li>Last but most important=&gt;Conclusion + Abstract + Refine Title</li>
<li>Figure =&gt; Almost the more the better</li>
<li>TODO</li>
</ol>
</li>
<li><p>Reference:</p>
<ul>
<li><a href="www.jdl.ac.cn/user/sgshan/PaperWriting.pdf">撰写学术论文的经验和教训</a></li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2017/12/17/Different-Levels-of-Write-Read-Lock/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2017/12/17/Different-Levels-of-Write-Read-Lock/" itemprop="url">Different Levels of Write Read Lock</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-17T13:19:12+08:00">
                2017-12-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Read write lock is a <a href="https://en.wikipedia.org/wiki/Synchronization_(computer_science" target="_blank" rel="external">synchronization</a> technology to solve multi read and write problem. There are three priorities: Read-prefering RW lock, Write-prefering RW lock, and Unspecified priority RW locks. </p>
<p>There are some libraries provide read write lock functions, like:</p>
<ul>
<li>POSIX standard WR lock <code>pthread_rwlock_t</code> (This WR lock provides different priorities)</li>
<li><code>std::shared_mutex</code> in <code>C++17</code></li>
<li><code>boost::shared_mutex</code> and <code>boost::upgrade_mutex</code> in <code>boost library</code></li>
</ul>
<p>The <a href="https://en.wikipedia.org/wiki/Read-copy-update" title="Read-copy-update" target="_blank" rel="external">read-copy-update</a> (a.k.a. RCU) is another method to solve mutli reader and write problem. Another solution is <code>seqlock</code> for fewer readers.</p>
<p>A simple persudo implementation:<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">begin_read</span><span class="params">()</span> </span>&#123;</div><div class="line">  lock_r();</div><div class="line">  counter ++;</div><div class="line">  <span class="keyword">if</span> (counter == <span class="number">1</span>) lock_w();</div><div class="line">  unlock_r()</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">end_read</span><span class="params">()</span> </span>&#123;</div><div class="line">  lock_r();</div><div class="line">  counter --;</div><div class="line">  <span class="keyword">if</span> (counter == <span class="number">0</span>) unlock_w();</div><div class="line">  unlock_r();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">begin_write</span><span class="params">()</span> </span>&#123;</div><div class="line">  lock_w();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">end_write</span><span class="params">()</span> </span>&#123;</div><div class="line">  unlock_w();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>More details about implementation in <code>C++11</code> (use atomic variable as spinlock), please see <a href="">this</a>.</p>
<p>BTH, this simple WR_lock implement method do not gurantee writer has a higher priority.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2017/10/20/C-20-Transaction-Memory/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2017/10/20/C-20-Transaction-Memory/" itemprop="url">C++20 Transaction Memory</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-20T00:16:02+08:00">
                2017-10-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>Transaction Memory</code> is a concurrency mechanism, which provides atomic and isolated compared with normal memory access. <code>Transaction memory</code> is easy to use, and simplify concurrent programming without lock or extra concurrent control method.</p>
<p>C++20 implements <code>Transaction Memory</code>, and makes this becomes a standard in C++. I think this is the inevitable trend with rapid development in multi-core programming.</p>
<p>In <code>gcc-7</code>, programmer can use more than three ways to use <code>Transaction Memory</code>, and I will introduce how to write codes by taking advantage of <code>Transaction Memory</code></p>
<p>Below is a example with using <code>synchronized</code> keyword to achieve synchronized of multi threads.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">    synchronized &#123; <span class="comment">// begin synchronized block</span></div><div class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">" -&gt; "</span>;</div><div class="line">        ++i;       <span class="comment">// each call to f() obtains a unique value of i</span></div><div class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">'\n'</span>;</div><div class="line">        <span class="keyword">return</span> i; <span class="comment">// end synchronized block</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::thread&gt; v(<span class="number">10</span>);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; t: v)</div><div class="line">        t = <span class="built_in">std</span>::thread([]&#123; <span class="keyword">for</span>(<span class="keyword">int</span> n = <span class="number">0</span>; n &lt; <span class="number">10</span>; ++n) f(); &#125;);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; t: v)</div><div class="line">        t.join();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The output in screen is like that:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">0 -&gt; 1</div><div class="line">1 -&gt; 2</div><div class="line">...</div><div class="line">99 -&gt; 100</div></pre></td></tr></table></figure></p>
<p>Only one thread can access this variable <code>i</code> at any time.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2017/10/19/Some-Useful-Technologies-About-RDMA-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2017/10/19/Some-Useful-Technologies-About-RDMA-2/" itemprop="url">Some Useful Technologies About RDMA(2)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-19T21:13:25+08:00">
                2017-10-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ODP"><a href="#ODP" class="headerlink" title="ODP"></a>ODP</h1><h1 id="Tag"><a href="#Tag" class="headerlink" title="Tag"></a>Tag</h1><h1 id="TOS"><a href="#TOS" class="headerlink" title="TOS"></a>TOS</h1><h1 id="Dynamically-Connected-Transport"><a href="#Dynamically-Connected-Transport" class="headerlink" title="Dynamically Connected Transport"></a>Dynamically Connected Transport</h1>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2017/10/09/My-Understanding-about-Hierarchy-of-Needs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2017/10/09/My-Understanding-about-Hierarchy-of-Needs/" itemprop="url">My Understanding about Hierarchy of Needs</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-09T20:21:15+08:00">
                2017-10-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Level 5</div><div class="line">Level 4</div><div class="line">Level 3</div><div class="line">Level 2</div><div class="line">Level 1</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/blog/2017/10/05/How-to-Build-a-Non-Volatile-Memory-DBMS-Survey/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Teng Ma">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/blog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Teng's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2017/10/05/How-to-Build-a-Non-Volatile-Memory-DBMS-Survey/" itemprop="url">How to Build a Non-Volatile Memory DBMS (Survey)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-05T11:13:48+08:00">
                2017-10-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>This is a summary about a <a href="https://www.cs.cmu.edu/~jarulraj/papers/2017.nvm.sigmod.pdf" target="_blank" rel="external">paper</a> and a related <a href="https://www.cs.cmu.edu/~jarulraj/talks/2017.nvm.sigmod.pdf" target="_blank" rel="external">talk</a> in <code>Sigmod 17</code>, and this paper concludes the three main ways to make use of the special features in NVM when build up a DBMS.</p>
<hr>
<h2 id="NVM-properties"><a href="#NVM-properties" class="headerlink" title="NVM properties:"></a>NVM properties:</h2><ul>
<li><ol>
<li>Byte addressable: Loads and stores un`like SSD/HDD</li>
<li>High random write throughput: Orders of magnitude higher than SSD/HDD, Smaller gap between sequential &amp; random write throughput.</li>
<li>Read-write asymmetry &amp; wear-leveling: Writes might take longer to complete compared to reads. Excessive writes to a single NVM cell can destroy it.</li>
</ol>
</li>
</ul>
<h2 id="Evaluation-NVM"><a href="#Evaluation-NVM" class="headerlink" title="Evaluation NVM"></a>Evaluation NVM</h2><ul>
<li>=&gt; HDD/SSD/Emulated NVM.<ul>
<li>Tune DRAM latency to emulate NVM (increasing latency)</li>
<li>CLWB (Cache-line write back) instruction</li>
</ul>
</li>
</ul>
<h1 id="Three-levels-in-NVM-DBMS"><a href="#Three-levels-in-NVM-DBMS" class="headerlink" title="Three levels in NVM DBMS:"></a>Three levels in NVM DBMS:</h1><p>1) Access Interfaces,<br>2) Storage Manager<br>3) Execution Engine.</p>
<h2 id="Allocation-interface"><a href="#Allocation-interface" class="headerlink" title="Allocation interface"></a>Allocation interface</h2><ul>
<li><p>Standard functions</p>
<ul>
<li>Dynamic memory allocation</li>
<li>Meta-data management</li>
</ul>
<ul>
<li>Durability mechanism<ul>
<li>Two-step implementation<ul>
<li>Allocation first by using CLWB</li>
<li>Issues a SFENCE to make sure changes are visible</li>
</ul>
</li>
</ul>
</li>
<li>Naming mechanism<ul>
<li>Map NVM to a well know base address, <code>Absolute pointer = Base address + Relative pointer</code></li>
</ul>
</li>
<li>Recovery mechanism<ul>
<li>Consider a crashing before linking the chunk to DS which occur to losing of this chunk (neither allocator nor application can reclaim the space).</li>
</ul>
</li>
</ul>
</li>
<li><p>File system interface</p>
<ul>
<li>Device -&gt; page cache -&gt; app buffer =&gt; Device -&gt; app buffer </li>
<li>64 bytes cache line atomic</li>
</ul>
</li>
</ul>
<h2 id="Storage-Manager"><a href="#Storage-Manager" class="headerlink" title="Storage Manager"></a>Storage Manager</h2><ul>
<li>Logging &amp; Recovery<ul>
<li>Write ahead log (<code>LET’S TALK ABOUT STORAGE AND RECOVERY METHODS FOR NON-VOLATILE MEMORY DATABASE SYSTEMS SIGMOD&#39; 2015</code>)<ul>
<li>Avoid duplicating data in the log and the checkpoint<ul>
<li>logging the meta-data not the data updates</li>
<li><code>WAL + FS API</code> vs. <code>WA(meta-data)L + Allocation API</code> </li>
</ul>
</li>
</ul>
</li>
<li>Write behind log (<code>WRITE-BEHIND LOGGING VLDB&#39; 17</code>)<ul>
<li>pros<ol>
<li>Write-behind logging enables instant recovery</li>
<li>Improves device utilization by reducing data duplication</li>
<li>Extends the device lifetime </li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
<li>Data placement<ul>
<li>Three-tiers: DRAM (meta-data + data) + NVM (log + data) + SSD (data)</li>
<li>DRAM -&gt; hot data (cache), NVM -&gt; warm data, SSD -&gt; cold data</li>
</ul>
</li>
</ul>
<h2 id="Access-Methods"><a href="#Access-Methods" class="headerlink" title="Access Methods"></a>Access Methods</h2><ul>
<li>Read-write asymmetry &amp; wear-leveling<br>  – Writes might take longer to complete compared to reads<br>  – Excessive writes to a single NVM cell can destroy it</li>
<li>Write-limited access methods<ul>
<li>NVM-aware B+Tree, hash table<ul>
<li>NVM-aware B+Tree: <ul>
<li>In leaf node, using linear scan (unsorted data) with fewer writes instead of binary search (sorted data) with more writes.</li>
<li>Using unbalanced tree (fewer writes)</li>
</ul>
</li>
<li></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="Execution-engine"><a href="#Execution-engine" class="headerlink" title="Execution engine"></a>Execution engine</h1><ul>
<li>Plan executor<ul>
<li>reduce the number of writes (Sorting algorithm and join algorithm) by using 1) adjustment of write-intensivity knob and 2) write-limited algorithms.<ul>
<li>Hybrid join/sort</li>
<li>Segment sort =&gt; adjust x (x% merge sort + (1-x)% selection sort)</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="page-number" href="/blog/page/3/">3</a><a class="extend next" rel="next" href="/blog/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/blog/images/avatar.gif"
               alt="Teng Ma" />
          <p class="site-author-name" itemprop="name">Teng Ma</p>
           
              <p class="site-description motion-element" itemprop="description">...</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/blog/archives/">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/blog/tags/index.html">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/stmatengss" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://stackoverflow.com/users/5955640/stmatengss" target="_blank" title="Stackoverflow">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Stackoverflow
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/ma-teng-69a0a8115/" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Linkedin
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Teng Ma</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/blog/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/blog/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/blog/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/blog/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/blog/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/blog/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/blog/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/blog/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/blog/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/blog/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
